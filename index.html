<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Worker Financial Calculator (SG)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for professional look and feel */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .input-group { display: flex; flex-direction: column; }
        .input-field { transition: border-color 0.2s, box-shadow 0.2s; }
        .input-error { border-color: #ef4444; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.4); }
        .bg-disabled { background-color: #e5e7eb !important; } /* Tailwind gray-200 */
    </style>
</head>
<body class="p-4 sm:p-8 flex justify-center">

    <div id="app-container" class="w-full max-w-xl bg-white rounded-xl shadow-2xl overflow-hidden">
        <header class="bg-indigo-700 text-white p-6 text-center">
            <h1 class="text-2xl font-bold">Singapore Platform Worker Calculator</h1>
            <p class="text-sm opacity-90 mt-1">CPF, PCTS, and WIS Eligibility (2025-2028)</p>
        </header>

        <!-- 1. Disclaimer Section -->
        <div class="p-4 bg-yellow-100 text-yellow-800 text-xs border-b border-yellow-300">
            <p class="font-semibold mb-1">Disclaimer:</p>
            <p>This calculator provides **estimates only** based on published rates for the Platform Worker CPF scheme (2025-2028). Workers should **always consult the official CPF Board website or contact CPF directly** for personalized advice and accurate contribution amounts. **</p>
        </div>

        <!-- Input Section -->
        <div id="input-frame" class="p-6 space-y-4 bg-blue-50">
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">Input Parameters</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                
                <!-- 1. Year Selection (Dynamically Populated) -->
                <div class="input-group">
                    <label for="year" class="text-gray-600 font-medium mb-1">Calculation Year (Current/Future):</label>
                    <select id="year" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>

                <!-- 2. Monthly Earn Income -->
                <div class="input-group">
                    <label for="earnIncome" class="text-gray-600 font-medium mb-1">Monthly Earn Income (S$):</label>
                    <input type="number" id="earnIncome" placeholder="e.g., 2500" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                
                <!-- 3. Worker's Age -->
                <div class="input-group">
                    <label for="age" class="text-gray-600 font-medium mb-1">Worker's Age (Must be 18+):</label>
                    <input type="number" id="age" placeholder="e.g., 30" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                
                <!-- 4. Deduction Tier - Added onchange event -->
                <div class="input-group">
                    <label for="deductionTier" class="text-gray-600 font-medium mb-1">Fixed Expense Deduction Tier:</label>
                    <select id="deductionTier" onchange="handleTierChange()" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="1">1: Low (Foot, Public Transport) - 20%</option>
                        <option value="2">2: Medium (PMD/PAB/Motorcycle) - 35%</option>
                        <option value="3" selected>3: High (Car/Van) - 60%</option>
                    </select>
                </div>

                <!-- 5. Motorized Mode Multiplier Check -->
                <div class="input-group sm:col-span-2">
                    <label for="modeMultiplier" class="text-gray-600 font-medium mb-1">Mode Multiplier Check (Type 2, +10% Deduction):</label>
                    <select id="modeMultiplier" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 bg-disabled" disabled>
                        <option value="1" selected>1: No Multiplier Applied</option>
                        <option value="2">2: Apply 10% Multiplier (If using motorized PMD/PAB/Motorcycle)</option>
                    </select>
                    <p id="multiplierNote" class="text-xs text-gray-500 mt-1">Multiplier is automatically disabled for Tier 3.</p>
                </div>
            </div>

            <!-- Calculation and Reset Buttons -->
            <div class="flex space-x-4 mt-4">
                <button onclick="calculate()" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]">
                    Calculate Financial Benefits
                </button>
                <button onclick="resetForm()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]">
                    Reset
                </button>
            </div>
        </div>

        <!-- Result Section -->
        <div id="output-frame" class="p-6 space-y-3 bg-yellow-50">
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">Calculation Results</h2>

            <div class="grid grid-cols-2 gap-y-3">
                <span class="font-medium text-gray-600">Net Trade Income (NTI):</span>
                <span id="netIncomeValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <!-- WORKER'S SHARE (GAP 1: Capped by OW Ceiling) -->
                <span class="font-medium text-gray-600">CPF Contribution (Worker's Share):</span>
                <span id="cpfValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>
                
                <!-- PLATFORM'S SHARE (GAP 2: New Calculation) -->
                <span class="font-medium text-gray-600">Platform's Mandatory CPF Contribution:</span>
                <span id="sbCpfValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <span class="font-medium text-gray-600">Total Mandatory CPF (Worker + Platform):</span>
                <span id="totalCpfValue" class="text-right font-bold text-xl text-green-700">$ 0.00</span>
                
                <span class="font-medium text-gray-600">PCTS Amount:</span>
                <span id="pctsValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <span class="font-medium text-gray-600">WIS Eligibility (Income Check):</span>
                <span id="wisValue" class="text-right font-bold text-lg text-gray-500">--</span>
            </div>
        </div>
    </div>

    <script>
        // --- Financial Constants ---
        const MIN_YEAR = 2025; 
        const MAX_YEAR = 2028; 

        // 1. OW Ceiling (Capped NTI for CPF calculation purposes)
        const OW_CEILINGS = {
            2025: 6800, // Based on announced OW Ceiling schedule
            2026: 6800,
            2027: 6800,
            2028: 6800
        };

        const DEDUCTION_RATES = {
            2025: { 1: 0.20, 2: 0.35, 3: 0.60 },
            2026: { 1: 0.20, 2: 0.35, 3: 0.60 },
            2027: { 1: 0.20, 2: 0.35, 3: 0.60 },
            2028: { 1: 0.20, 2: 0.35, 3: 0.60 }
        };

        const PCTS_RATES = {
            2025: 0.025,
            2026: 0.050 * 0.75,
            2027: 0.070 * 0.50,
            2028: 0.090 * 0.25
        };

        // Simplified Worker's CPF Contribution Rates (Employee Share) based on age band
        const CPF_RATES = {
            2025: { '55_and_below': 0.135, 'above_55': 0.090 },
            2026: { '55_and_below': 0.155, 'above_55': 0.100 },
            2027: { '55_and_below': 0.180, 'above_55': 0.110 },
            2028: { '55_and_below': 0.200, 'above_55': 0.120 }
        };

        // 2. Platform/Service Buyer (SB) Contribution Rates on NTI
        // These are phased-in mandatory contribution rates for the platform.
        const SB_CPF_RATES_FLAT = {
            2025: 0.015, // 1.5%
            2026: 0.030, // 3.0%
            2027: 0.045, // 4.5%
            2028: 0.060  // 6.0%
        };

        // --- Core Calculation Logic ---

        function getCpfRate(year, age) {
            const yearRates = CPF_RATES[year] || {};
            if (age <= 55) {
                return yearRates['55_and_below'] || 0;
            } else {
                return yearRates['above_55'] || 0;
            }
        }

        function calculateNetIncome(year, earnIncome, deductionTier, modeMultiplier) {
            let deductionRate = DEDUCTION_RATES[year]?.[deductionTier] || 0;

            if (modeMultiplier === 2) {
                deductionRate *= 1.1;
            }

            // Net Trade Income (NTI)
            const netIncome = earnIncome * (1 - deductionRate);
            return parseFloat(netIncome.toFixed(2));
        }

        function calculatePctsAmount(year, netIncome) {
            const PCTS_THRESHOLD = 3000;
            if (netIncome >= PCTS_THRESHOLD) {
                return 0;
            }
            const pctsRate = PCTS_RATES[year] || 0;
            return parseFloat((netIncome * pctsRate).toFixed(2));
        }
        
        function checkWisEligibility(netIncome) {
            const MIN_INCOME_WIS = 500;
            const MAX_INCOME_WIS = 3000;
            
            if (netIncome >= MIN_INCOME_WIS && netIncome <= MAX_INCOME_WIS) {
                // Note: This only checks income range, not full criteria
                return { text: "ELIGIBLE (Income Check Passed)", color: "green-600" };
            } else {
                return { text: "NOT ELIGIBLE (Income Range)", color: "red-500" };
            }
        }

        // --- UI Handling and Validation ---

        function highlightError(elementId, isError) {
            const element = document.getElementById(elementId);
            if (isError) {
                element.classList.add('input-error');
                element.classList.add('border-red-500');
            } else {
                element.classList.remove('input-error');
                element.classList.remove('border-red-500');
            }
        }

        function handleTierChange() {
            const tierSelect = document.getElementById('deductionTier');
            const multiplierSelect = document.getElementById('modeMultiplier');
            const multiplierNote = document.getElementById('multiplierNote');
            
            if (tierSelect.value === '3') {
                multiplierSelect.value = '1'; // Force "No Multiplier"
                multiplierSelect.disabled = true;
                multiplierSelect.classList.add('bg-disabled');
                multiplierNote.textContent = 'Multiplier is automatically disabled for Tier 3.';
            } else {
                multiplierSelect.disabled = false;
                multiplierSelect.classList.remove('bg-disabled');
                multiplierNote.textContent = 'Apply 10% multiplier if using motorized PMD/PAB/Motorcycle (Tier 2).';
            }
        }

        function resetForm() {
            const currentSystemYear = new Date().getFullYear();
            const defaultYear = Math.max(MIN_YEAR, Math.min(MAX_YEAR, currentSystemYear));

            document.getElementById('year').value = defaultYear;
            document.getElementById('earnIncome').value = '';
            document.getElementById('age').value = ''; 
            document.getElementById('deductionTier').value = 3; 
            
            handleTierChange();

            // Clear error highlights
            highlightError('earnIncome', false);
            highlightError('age', false);
            
            // Reset result labels
            document.getElementById('netIncomeValue').textContent = '$ 0.00';
            document.getElementById('cpfValue').textContent = '$ 0.00';
            document.getElementById('sbCpfValue').textContent = '$ 0.00'; // Reset platform share
            document.getElementById('totalCpfValue').textContent = '$ 0.00'; // Reset total CPF
            document.getElementById('pctsValue').textContent = '$ 0.00';
            
            document.getElementById('wisValue').textContent = '--';
            document.getElementById('wisValue').classList.value = 'text-right font-bold text-lg text-gray-500';
        }

        function calculate() {
            let isValid = true;

            // 1. Get Inputs
            const year = parseInt(document.getElementById('year').value);
            const earnIncomeInput = document.getElementById('earnIncome');
            const ageInput = document.getElementById('age'); 
            const deductionTier = parseInt(document.getElementById('deductionTier').value);
            const modeMultiplier = parseInt(document.getElementById('modeMultiplier').value); 
            
            // 2. Validation
            const earnIncome = parseFloat(earnIncomeInput.value);
            const age = parseInt(ageInput.value); 

            if (isNaN(earnIncome) || earnIncome <= 0) {
                highlightError('earnIncome', true);
                isValid = false;
            } else {
                highlightError('earnIncome', false);
            }

            if (isNaN(age) || age < 18 || age > 100) { 
                highlightError('age', true);
                isValid = false;
            } else {
                highlightError('age', false);
            }

            if (!isValid) {
                document.getElementById('wisValue').textContent = "Input Error";
                document.getElementById('wisValue').classList.value = 'text-right font-bold text-lg text-red-500';
                // Reset other values on error
                document.getElementById('netIncomeValue').textContent = '$ 0.00';
                document.getElementById('cpfValue').textContent = '$ 0.00';
                document.getElementById('sbCpfValue').textContent = '$ 0.00'; 
                document.getElementById('totalCpfValue').textContent = '$ 0.00';
                document.getElementById('pctsValue').textContent = '$ 0.00';
                return;
            }

            // 3. Perform Calculations
            const netIncome = calculateNetIncome(year, earnIncome, deductionTier, modeMultiplier);
            
            // --- GAP 1 Fix: Apply OW Ceiling ---
            const owCeiling = OW_CEILINGS[year] || 6800;
            // The amount of NTI that is subjected to CPF contribution
            const cpfCalculableIncome = Math.min(netIncome, owCeiling); 

            // Calculate Worker's Share
            const cpfRate = getCpfRate(year, age);
            const cpfContribution = parseFloat((cpfCalculableIncome * cpfRate).toFixed(2));
            
            // --- GAP 2 Fix: Calculate Service Buyer's Share ---
            const sbCpfRate = SB_CPF_RATES_FLAT[year] || 0; 
            const sbContribution = parseFloat((cpfCalculableIncome * sbCpfRate).toFixed(2));

            const totalCpf = parseFloat((cpfContribution + sbContribution).toFixed(2));
            
            const pctsAmount = calculatePctsAmount(year, netIncome);
            const wisEligibility = checkWisEligibility(netIncome);

            // 4. Display Results
            document.getElementById('netIncomeValue').textContent = `$ ${netIncome.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('cpfValue').textContent = `$ ${cpfContribution.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('sbCpfValue').textContent = `$ ${sbContribution.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('totalCpfValue').textContent = `$ ${totalCpf.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('pctsValue').textContent = `$ ${pctsAmount.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            
            document.getElementById('wisValue').textContent = wisEligibility.text;
            document.getElementById('wisValue').classList.value = `text-right font-bold text-lg text-${wisEligibility.color}`;
        }
        
        // Function to dynamically populate the year dropdown
        function populateYearDropdown() {
            const yearSelect = document.getElementById('year');
            const currentSystemYear = new Date().getFullYear();
            
            const defaultYear = Math.max(MIN_YEAR, Math.min(MAX_YEAR, currentSystemYear));
            
            for (let y = currentSystemYear; y <= MAX_YEAR; y++) {
                if (y < MIN_YEAR) continue; 

                const option = document.createElement('option');
                option.value = y;
                option.textContent = y;
                if (y === defaultYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }

            if (currentSystemYear > MAX_YEAR) {
                const option = document.createElement('option');
                option.value = MAX_YEAR;
                option.textContent = `${MAX_YEAR} (Latest Available Data)`;
                option.selected = true;
                yearSelect.appendChild(option);
                yearSelect.disabled = true;
            }
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
             populateYearDropdown();
             resetForm(); 
        });

    </script>
</body>
</html>


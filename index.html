
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Worker Financial Calculator (SG)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for professional look and feel */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .input-group { display: flex; flex-direction: column; }
        .input-field { transition: border-color 0.2s, box-shadow 0.2s; }
        .input-error { border-color: #ef4444; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.4); }
    </style>
</head>
<body class="p-4 sm:p-8 flex justify-center">

    <div id="app-container" class="w-full max-w-xl bg-white rounded-xl shadow-2xl overflow-hidden">
        <header class="bg-indigo-700 text-white p-6 text-center">
            <h1 class="text-2xl font-bold">Singapore Platform Worker Calculator</h1>
            <p class="text-sm opacity-90 mt-1">CPF, PCTS, and WIS Eligibility (2025-2028)</p>
        </header>

        <!-- Input Section -->
        <div id="input-frame" class="p-6 space-y-4 bg-blue-50">
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">Input Parameters</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                
                <!-- 1. Year Selection -->
                <div class="input-group">
                    <label for="year" class="text-gray-600 font-medium mb-1">Calculation Year:</label>
                    <select id="year" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                    </select>
                </div>

                <!-- 2. Monthly Earn Income -->
                <div class="input-group">
                    <label for="earnIncome" class="text-gray-600 font-medium mb-1">Monthly Earn Income (S$):</label>
                    <input type="number" id="earnIncome" placeholder="e.g., 2500" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                
                <!-- 3. Year of Birth -->
                <div class="input-group">
                    <label for="yearOfBirth" class="text-gray-600 font-medium mb-1">Year of Birth:</label>
                    <input type="number" id="yearOfBirth" placeholder="e.g., 1995" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                
                <!-- 4. Deduction Tier -->
                <div class="input-group">
                    <label for="deductionTier" class="text-gray-600 font-medium mb-1">Fixed Expense Deduction Tier:</label>
                    <select id="deductionTier" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="1">1: Low (Foot, Public Transport) - 20%</option>
                        <option value="2">2: Medium (PMD/PAB/Motorcycle) - 35%</option>
                        <option value="3" selected>3: High (Car/Van) - 60%</option>
                    </select>
                </div>

                <!-- 5. Motorized Mode Multiplier Check -->
                <div class="input-group sm:col-span-2">
                    <label for="modeMultiplier" class="text-gray-600 font-medium mb-1">Mode Multiplier Check (Type 2, +10% Deduction):</label>
                    <select id="modeMultiplier" class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="1" selected>1: No Multiplier Applied</option>
                        <option value="2">2: Apply 10% Multiplier (If using motorized PMD/PAB/Motorcycle)</option>
                    </select>
                </div>
            </div>

            <button onclick="calculate()" class="w-full mt-4 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]">
                Calculate Financial Benefits
            </button>
        </div>

        <!-- Result Section -->
        <div id="output-frame" class="p-6 space-y-3 bg-yellow-50">
            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">Calculation Results</h2>

            <div class="grid grid-cols-2 gap-y-3">
                <span class="font-medium text-gray-600">Net Income:</span>
                <span id="netIncomeValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <span class="font-medium text-gray-600">CPF Contribution (Employee Share):</span>
                <span id="cpfValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>
                
                <span class="font-medium text-gray-600">PCTS Amount:</span>
                <span id="pctsValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <span class="font-medium text-gray-600">WIS Eligibility:</span>
                <span id="wisValue" class="text-right font-bold text-lg text-gray-500">--</span>
            </div>
        </div>
    </div>

    <script>
        // --- Financial Constants (Equivalent to Python Class) ---
        const DEDUCTION_RATES = {
            2025: { 1: 0.20, 2: 0.35, 3: 0.60 },
            2026: { 1: 0.20, 2: 0.35, 3: 0.60 },
            2027: { 1: 0.20, 2: 0.35, 3: 0.60 },
            2028: { 1: 0.20, 2: 0.35, 3: 0.60 }
        };

        const PCTS_RATES = {
            2025: 0.025,
            2026: 0.050 * 0.75,
            2027: 0.070 * 0.50,
            2028: 0.090 * 0.25
        };

        // Simplified CPF Rates (Employee Share) based on age band for the given year
        const CPF_RATES = {
            2025: { '55_and_below': 0.135, 'above_55': 0.090 },
            2026: { '55_and_below': 0.155, 'above_55': 0.100 },
            2027: { '55_and_below': 0.180, 'above_55': 0.110 },
            2028: { '55_and_below': 0.200, 'above_55': 0.120 }
        };

        // --- Core Calculation Logic ---

        function calculateAge(yearOfBirth, calculationYear) {
            return calculationYear - yearOfBirth;
        }

        function getCpfRate(year, age) {
            const yearRates = CPF_RATES[year] || {};
            if (age <= 55) {
                return yearRates['55_and_below'] || 0;
            } else {
                return yearRates['above_55'] || 0;
            }
        }

        function calculateNetIncome(year, earnIncome, deductionTier, modeMultiplier) {
            let deductionRate = DEDUCTION_RATES[year]?.[deductionTier] || 0;

            // Apply 10% multiplier if modeMultiplier is 2
            if (modeMultiplier === 2) {
                deductionRate *= 1.1;
            }

            const netIncome = earnIncome * (1 - deductionRate);
            return parseFloat(netIncome.toFixed(2));
        }

        function calculatePctsAmount(year, netIncome) {
            const PCTS_THRESHOLD = 3000;
            if (netIncome >= PCTS_THRESHOLD) {
                return 0;
            }
            const pctsRate = PCTS_RATES[year] || 0;
            return parseFloat((netIncome * pctsRate).toFixed(2));
        }
        
        function checkWisEligibility(netIncome) {
            const MIN_INCOME_WIS = 500;
            const MAX_INCOME_WIS = 3000;
            
            if (netIncome >= MIN_INCOME_WIS && netIncome <= MAX_INCOME_WIS) {
                return { text: "ELIGIBLE", color: "green-600" };
            } else {
                return { text: "NOT ELIGIBLE", color: "red-500" };
            }
        }

        // --- UI Handling and Validation ---

        function highlightError(elementId, isError) {
            const element = document.getElementById(elementId);
            if (isError) {
                element.classList.add('input-error');
                element.classList.add('border-red-500');
            } else {
                element.classList.remove('input-error');
                element.classList.remove('border-red-500');
            }
        }

        function calculate() {
            let isValid = true;

            // 1. Get Inputs
            const year = parseInt(document.getElementById('year').value);
            const earnIncomeInput = document.getElementById('earnIncome');
            const yearOfBirthInput = document.getElementById('yearOfBirth');
            const deductionTier = parseInt(document.getElementById('deductionTier').value);
            const modeMultiplier = parseInt(document.getElementById('modeMultiplier').value);
            
            // 2. Validation
            const earnIncome = parseFloat(earnIncomeInput.value);
            const yearOfBirth = parseInt(yearOfBirthInput.value);
            const currentYear = new Date().getFullYear();

            // Calculate the maximum allowed birth year to ensure the worker is at least 18 in the calculation year
            const maxAllowedBirthYear = year - 18; 

            if (isNaN(earnIncome) || earnIncome < 0) {
                highlightError('earnIncome', true);
                isValid = false;
            } else {
                highlightError('earnIncome', false);
            }

            // Enhanced Year of Birth Validation
            if (isNaN(yearOfBirth) || yearOfBirth < 1900 || yearOfBirth > currentYear || yearOfBirth > maxAllowedBirthYear) {
                highlightError('yearOfBirth', true);
                isValid = false;
            } else {
                highlightError('yearOfBirth', false);
            }

            if (!isValid) {
                document.getElementById('wisValue').textContent = "Input Error";
                document.getElementById('wisValue').classList.value = 'text-right font-bold text-lg text-red-500';
                return;
            }

            // 3. Perform Calculations
            const netIncome = calculateNetIncome(year, earnIncome, deductionTier, modeMultiplier);
            const age = calculateAge(yearOfBirth, year);
            
            const cpfRate = getCpfRate(year, age);
            const cpfContribution = parseFloat((netIncome * cpfRate).toFixed(2));
            
            const pctsAmount = calculatePctsAmount(year, netIncome);
            const wisEligibility = checkWisEligibility(netIncome);

            // 4. Display Results
            document.getElementById('netIncomeValue').textContent = `$ ${netIncome.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('cpfValue').textContent = `$ ${cpfContribution.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            document.getElementById('pctsValue').textContent = `$ ${pctsAmount.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;
            
            document.getElementById('wisValue').textContent = wisEligibility.text;
            document.getElementById('wisValue').classList.value = `text-right font-bold text-lg text-${wisEligibility.color}`;
        }
        
        // Initial calculation or default display setup (optional)
        document.addEventListener('DOMContentLoaded', () => {
             // Set default year of birth to current year - 30 as a common age example
             document.getElementById('yearOfBirth').value = new Date().getFullYear() - 30;
             document.getElementById('earnIncome').value = 3000;
             calculate();
        });

    </script>
</body>
</html>



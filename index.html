<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Platform Worker Financial Calculator (SG) V2.5</title>

    <!-- Load Tailwind CSS -->

    <script src="https://cdn.tailwindcss.com"></script>

    <style>

        /* Custom styles for professional look and feel */

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        
        html, body {

            min-height: 100vh;

        }

        body { 

            font-family: 'Inter', sans-serif;

            background-color: #f3f4f6; 

            overflow-y: auto; 

        }

        

        .input-group { display: flex; flex-direction: column; }

        .input-field { transition: border-color 0.2s, box-shadow 0.2s; }

        /* Defined error style for consistent highlighting */

        .input-error { 

            border-color: #ef4444 !important;

            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.4); 

        }

        .bg-disabled { background-color: #e5e7eb !important; } /* Tailwind gray-200 */

    </style>

</head>

<body class="p-4 sm:p-8 flex justify-center">

    <div id="app-container"
        class="w-full max-w-xl bg-white rounded-xl shadow-2xl overflow-hidden">

        <header class="bg-indigo-700 text-white p-6 text-center">

            <h1 class="text-2xl font-bold">Singapore Platform Worker Calculator</h1>

            <p class="text-sm opacity-90 mt-1">CPF, PCTS, and WIS Eligibility (2025-2028) - V2.5</p>

        </header>

        <!-- 1. Disclaimer Section -->

        <div class="p-4 bg-yellow-100 text-yellow-800 text-xs border-b border-yellow-300">

            <p class="font-semibold mb-1">Disclaimer:</p>

            <p>This calculator provides **estimates only** based on published rates for the Platform Worker CPF scheme (2025-2028). Workers should **always consult the official CPF Board website or contact CPF directly** for personalized advice and accurate contribution amounts.</p>

        </div>

        <!-- Input Section -->

        <div id="input-frame" class="p-6 space-y-4 bg-blue-50">

            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">Input Parameters</h2>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

                <!-- 1. Year Selection -->
                <div class="input-group">
                    <label for="year" class="text-gray-600 font-medium mb-1">Calculation Year (2025 - 2028):</label>
                    <select id="year"
                        class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>

                <!-- 2. Monthly Earn Income -->
                <div class="input-group">
                    <label for="earnIncome" class="text-gray-600 font-medium mb-1">Monthly Earn Income (S$):</label>
                    <input type="number" id="earnIncome" placeholder="e.g., 2500"
                        class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <!-- 3. Worker's Age -->
                <div class="input-group">
                    <label for="age" class="text-gray-600 font-medium mb-1">Worker's Age (Must be 18+):</label>
                    <input type="number" id="age" placeholder="e.g., 30"
                        class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <!-- 4. Deduction Tier -->
                <div class="input-group">
                    <label for="deductionTier" class="text-gray-600 font-medium mb-1">Fixed Expense Deduction Tier:</label>
                    <select id="deductionTier" 
                        class="input-field p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="1">1: Low (Foot, Public Transport) - 20%</option>
                        <option value="2">2: Medium (PMD/PAB/Motorcycle) - 35%</option>
                        <option value="3" selected>3: High (Car/Van) - 60%</option>
                    </select>
                </div>

                <!-- The Mode Multiplier selection (Input 5) has been permanently removed -->
            </div>

            <!-- Calculation and Reset Buttons -->
            <div class="flex space-x-4 pt-4">
                <button onclick="calculate()"
                    class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]">
                    Calculate Financial Benefits
                </button>
                <button onclick="resetForm()"
                    class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-[1.01]">
                    Reset
                </button>
            </div>
        </div>

        <!-- Result Section -->
        <div id="output-frame" class="p-6 space-y-3 bg-yellow-50">

            <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">Calculation Results</h2>

            <div class="grid grid-cols-2 gap-y-3">
                <span class="font-medium text-gray-600">Net Trade Income (NTI):</span>
                <span id="netIncomeValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <!-- WORKER'S SHARE (Capped by OW Ceiling) -->
                <span class="font-medium text-gray-600">CPF Contribution (Worker's Share):</span>
                <span id="cpfValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <!-- PLATFORM'S SHARE -->
                <span class="font-medium text-gray-600">Platform's Mandatory CPF Contribution:</span>
                <span id="sbCpfValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <span class="font-medium text-gray-600">Total Mandatory CPF (Worker + Platform):</span>
                <span id="totalCpfValue" class="text-right font-bold text-xl text-green-700">$ 0.00</span>

                <span class="font-medium text-gray-600">PCTS Amount:</span>
                <span id="pctsValue" class="text-right font-bold text-lg text-indigo-600">$ 0.00</span>

                <span class="font-medium text-gray-600">WIS Eligibility (Income Check):</span>
                <span id="wisValue" class="text-right font-bold text-lg text-gray-500">--</span>
            </div>
        </div>
    </div>

    <script>
        // --- Financial Constants ---
        const MIN_YEAR = 2025; 
        const MAX_YEAR = 2028; 

        // OW Ceiling (Capped NTI for CPF calculation purposes)
        const OW_CEILINGS = {
            2025: 6800, 
            2026: 7400, 
            2027: 8000, 
            2028: 8800
        };
        
        // Deduction rates. Tier 2 is now correctly 35%.
        const DEDUCTION_TIERS = {
            1: 0.20, // Low (Foot, Public Transport)
            2: 0.35, // Medium (PMD/PAB/Motorcycle) - CORRECTED BACK TO 35%
            3: 0.60  // High (Car/Van)
        };
        
        // Platform Contributory Threshold Scheme (PCTS) rates
        const PCTS_RATES = {
            // Rates are applied on NTI < $3,000, then PCTS support tapers off.
            2025: 0.025,
            2026: 0.050 * 0.75, // Simplified representation of support structure
            2027: 0.070 * 0.50,
            2028: 0.090 * 0.25
        };

        // Simplified Worker's CPF Contribution Rates (Employee Share) based on age band
        const CPF_RATES = {
            2025: { '55_and_below': 0.135, 'above_55': 0.090 },
            2026: { '55_and_below': 0.155, 'above_55': 0.100 },
            2027: { '55_and_below': 0.180, 'above_55': 0.110 },
            2028: { '55_and_below': 0.200, 'above_55': 0.120 }
        };

        // Platform/Service Buyer (SB) Contribution Rates on NTI
        const SB_CPF_RATES_FLAT = {
            2025: 0.015, // 1.5%
            2026: 0.030, // 3.0%
            2027: 0.045, // 4.5%
            2028: 0.060  // 6.0%
        };
        
        // Cache DOM elements (modeMultiplierSelect removed)
        let yearSelect, earnIncomeInput, ageInput, deductionTierSelect;
        let netIncomeValue, cpfValue, sbCpfValue, totalCpfValue, pctsValue, wisValue;

        // --- Utility Functions ---

        /**
         * Helper function to round a number to two decimal places for currency.
         * @param {number} num - The number to round.
         * @returns {number} The rounded number.
         */
        function roundToTwoDecimals(num) {
            return Math.round(num * 100) / 100;
        }

        /**
         * Helper function to format a number as currency string.
         * @param {number} num - The number to format.
         * @returns {string} The formatted currency string.
         */
        function formatCurrency(num) {
            return `$ ${num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        // --- Core Calculation Logic ---

        function getCpfRate(year, age) {
            const yearRates = CPF_RATES[year] || {};
            if (age <= 55) {
                return yearRates['55_and_below'] || 0;
            } else {
                return yearRates['above_55'] || 0;
            }
        }

        /**
         * Calculates Net Trade Income (NTI).
         * Deduction rate is now strictly based on the selected tier constant.
         * @param {number} earnIncome - The worker's gross monthly income.
         * @param {number} deductionTier - The selected deduction tier (1, 2, or 3).
         * @returns {number} The calculated Net Trade Income.
         */
        function calculateNetIncome(earnIncome, deductionTier) {
            // Get rate directly from the DEDUCTION_TIERS map (now correct)
            let deductionRate = DEDUCTION_TIERS[deductionTier] || 0;

            // Ensure deduction rate does not exceed 100% (NTI floor is 0)
            deductionRate = Math.min(deductionRate, 1.0);

            // Net Trade Income (NTI) = Earn Income * (1 - Deduction Rate)
            const netIncome = earnIncome * (1 - deductionRate);
            
            // Round NTI to 2 decimal places
            return roundToTwoDecimals(netIncome);
        }

        function calculatePctsAmount(year, netIncome) {
            const PCTS_THRESHOLD = 3000;

            // PCTS applies only if NTI is below S$3,000
            if (netIncome >= PCTS_THRESHOLD) {
                return 0;
            }
            const pctsRate = PCTS_RATES[year] || 0;
            
            // Calculate PCTS amount and round
            return roundToTwoDecimals(netIncome * pctsRate);
        }
        
        function checkWisEligibility(netIncome) {
            const MIN_INCOME_WIS = 500;
            const MAX_INCOME_WIS = 3000;
            
            // WIS eligibility check is based on income range only for this calculator
            if (netIncome >= MIN_INCOME_WIS && netIncome <= MAX_INCOME_WIS) {
                return { text: "ELIGIBLE (Income Check Passed)", color: "green-600" };
            } else {
                return { text: "NOT ELIGIBLE (Income Range)", color: "red-500" };
            }
        }

        // --- UI Handling and Validation ---

        function highlightError(element, isError) {
            if (isError) {
                // Use input-error class defined in CSS
                element.classList.add('input-error');
            } else {
                element.classList.remove('input-error');
            }
        }
        
        // handleTierChange function is fully removed as it only controlled the multiplier input.

        function resetForm() {
            const currentSystemYear = new Date().getFullYear();
            
            // Default selected year: The earliest of the current year or MAX_YEAR, clamped to MIN_YEAR
            const defaultYear = Math.max(MIN_YEAR, Math.min(MAX_YEAR, currentSystemYear));

            yearSelect.value = defaultYear;
            earnIncomeInput.value = '';
            ageInput.value = ''; 
            deductionTierSelect.value = 3; // Default to Tier 3
            
            // Clear error highlights
            highlightError(earnIncomeInput, false);
            highlightError(ageInput, false);
            
            // Reset result labels 
            netIncomeValue.textContent = formatCurrency(0);
            cpfValue.textContent = formatCurrency(0);
            sbCpfValue.textContent = formatCurrency(0); 
            totalCpfValue.textContent = formatCurrency(0);
            pctsValue.textContent = formatCurrency(0);
            
            wisValue.textContent = '--';
            wisValue.classList.value = 'text-right font-bold text-lg text-gray-500';
        }

        function calculate() {
            let isValid = true;

            // 1. Get Inputs 
            const year = parseInt(yearSelect.value);
            const deductionTier = parseInt(deductionTierSelect.value);
            
            // 2. Validation
            const earnIncome = parseFloat(earnIncomeInput.value);
            const age = parseInt(ageInput.value); 

            if (isNaN(earnIncome) || earnIncome <= 0) {
                highlightError(earnIncomeInput, true);
                isValid = false;
            } else {
                highlightError(earnIncomeInput, false);
            }

            if (isNaN(age) || age < 18 || age > 100) { 
                highlightError(ageInput, true);
                isValid = false;
            } else {
                highlightError(ageInput, false);
            }

            if (!isValid) {
                wisValue.textContent = "Input Error";
                wisValue.classList.value = 'text-right font-bold text-lg text-red-500';
                
                // Reset other values on error
                netIncomeValue.textContent = formatCurrency(0);
                cpfValue.textContent = formatCurrency(0);
                sbCpfValue.textContent = formatCurrency(0); 
                totalCpfValue.textContent = formatCurrency(0);
                pctsValue.textContent = formatCurrency(0);
                return;
            }

            // 3. Perform Calculations
            const netIncome = calculateNetIncome(earnIncome, deductionTier);
            
            // Apply OW Ceiling (Capped NTI for CPF calculation purposes)
            const owCeiling = OW_CEILINGS[year] || 0; 
            const cpfCalculableIncome = Math.min(netIncome, owCeiling); 

            // Calculate Worker's Share
            const cpfRate = getCpfRate(year, age);
            const cpfContribution = roundToTwoDecimals(cpfCalculableIncome * cpfRate);
            
            // Calculate Service Buyer's Share
            const sbCpfRate = SB_CPF_RATES_FLAT[year] || 0; 
            const sbContribution = roundToTwoDecimals(cpfCalculableIncome * sbCpfRate);

            const totalCpf = roundToTwoDecimals(cpfContribution + sbContribution);
            
            const pctsAmount = calculatePctsAmount(year, netIncome);
            const wisEligibility = checkWisEligibility(netIncome);

            // 4. Display Results
            netIncomeValue.textContent = formatCurrency(netIncome);
            cpfValue.textContent = formatCurrency(cpfContribution);
            sbCpfValue.textContent = formatCurrency(sbContribution);
            totalCpfValue.textContent = formatCurrency(totalCpf);
            pctsValue.textContent = formatCurrency(pctsAmount);
            
            wisValue.textContent = wisEligibility.text;
            wisValue.classList.value = `text-right font-bold text-lg text-${wisEligibility.color}`;
        }
        
        // Function to dynamically populate the year dropdown
        function populateYearDropdown() {
            for (let y = MIN_YEAR; y <= MAX_YEAR; y++) {
                const option = document.createElement('option');
                option.value = y;
                option.textContent = y;
                yearSelect.appendChild(option);
            }
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            // Cache all necessary DOM elements once 
            yearSelect = document.getElementById('year');
            earnIncomeInput = document.getElementById('earnIncome');
            ageInput = document.getElementById('age'); 
            deductionTierSelect = document.getElementById('deductionTier');
            
            netIncomeValue = document.getElementById('netIncomeValue');
            cpfValue = document.getElementById('cpfValue');
            sbCpfValue = document.getElementById('sbCpfValue');
            totalCpfValue = document.getElementById('totalCpfValue');
            pctsValue = document.getElementById('pctsValue');
            wisValue = document.getElementById('wisValue');
            
            populateYearDropdown();

            // Call reset to set default values
            resetForm(); 
        });

    </script>

</body>

</html>
